<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salas</title>
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/cssmain.css">
    <meta name="theme-color" content="#ffffff">
</head>
<script type="text/javascript">
    // Register the service worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/static/service-worker.js')
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        });
    }

    // Example: API call to the backend
    // Load rooms on page load
    document.addEventListener('DOMContentLoaded', loadRooms);

function loadRooms() {
    fetch('/rooms')  // Adjust this API endpoint to fetch rooms
        .then(response => response.json())
        .then(data => {
            const roomSelect = document.getElementById('roomSelect');
            data.rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = room.name;
                roomSelect.appendChild(option);
            });
        })
        .catch(error => console.error('Error loading rooms:', error));
}

function loadRoomSchedule() {
    const roomId = document.getElementById('roomSelect').value;

    fetch(`/room/${roomId}/schedule`)  // Fetch schedule for the selected room
        .then(response => response.json())
        .then(data => {
            const scheduleSlots = document.getElementById('scheduleSlots');
            scheduleSlots.innerHTML = '';  // Clear previous schedule
            document.getElementById('scheduleContainer').style.display = 'block';  // Show schedule container

            data.schedule.forEach(slot => {
                const slotDiv = document.createElement('div');
                slotDiv.className = `schedule-slot ${slot.status.toLowerCase()}`;
                slotDiv.innerHTML = `<span class="time">${slot.time}</span>`;

                if (slot.status.toLowerCase() === 'occupied') {
                    slotDiv.innerHTML += `<div class="details">
                                            <p>Booked by: ${slot.meeting.booked_by}</p>
                                            <p>Purpose: ${slot.meeting.purpose}</p>
                                        </div>`;
                } else {
                    slotDiv.innerHTML += `<span>${slot.status}</span>`;
                }

                scheduleSlots.appendChild(slotDiv);
            });
        })
        .catch(error => console.error('Error loading schedule:', error));
}

    // Call the function on page load
    window.onload = loadRooms;
</script>
<body>
    <div class="sidebar">
        <div class="logo-container">
            <img src="/static/logo.png" alt="Company Logo" class="logo">
        </div>
        <a href="#">
            <img src="/static/homeico.png" alt="Home Icon"> 
            <span>In√≠cio</span>
        </a>
        <a href="#">
            <img src="/static/classicon.png" alt="Salas Icon"> 
            <span>Salas</span>
        </a>
        <a href="#">
            <img src="/static/scheduleicon.png" alt="Schedule Icon"> 
            <span>Agendamentos</span>
        </a>
    </div>

    <!-- Main content -->
    <div id="roomContainer">
        <select id="roomSelect" onchange="loadRoomSchedule()">
            <!-- Room options will be populated here -->
        </select>
    </div>

    <div id="scheduleContainer" style="display:none;">
        <h2>Room Schedule</h2>
        <div class="schedule-slots" id="scheduleSlots">
            <!-- Schedule slots will be populated here -->
        </div>
    </div>
</body>
</html>
