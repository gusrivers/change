<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Agendamento de salas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesr.css') }}">
</head>
<body>
    <header>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Company Logo" class="logo">
    </header>
    <h1>{{ room.name }}</h1>
    <div class="schedule-container">
        {% for slot in schedule %}
        <div class="schedule-slot {{ slot.status.lower() }}" onclick="openBookingModal('{{ slot.time }}', '{{ slot.status }}')">
            <span class="time">{{ slot.time }}</span>
            {% if slot.status.lower() == 'occupied' %}
            <div class="details">
                <p>Agendado por: {{ slot.meeting.booked_by }}</p>
                <p>Motivo: {{ slot.meeting.purpose }}</p>
            </div>
            {% else %}
            <span>{{ slot.status }}</span>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeBookingModal()">&times;</span>
            <h2>Agendar horário às <span id="modalTime"></span></h2>
            <form id="bookingForm" method="POST">
                <label for="username">Usuário:</label>
                <input type="text" name="username" id="username" required>
                <br>
                <label for="password">Senha:</label>
                <input type="password" name="password" id="password" required>
                <br>
                <label for="purpose">Motivo:</label>
                <input type="text" name="purpose" id="purpose" required>
                <br>
                <button type="button" onclick="confirmBooking()">Confirmar agendamento</button>
            </form>
        </div>
    </div>

    <script>
        function openBookingModal(time, status) {
            if (status.toLowerCase() === 'disponível') {
                document.getElementById('modalTime').textContent = time;
                document.getElementById('bookingModal').style.display = 'block';
            } else {
                alert('Esse horário não está disponível.');
            }
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').style.display = 'none';
        }

        function confirmBooking() {
            const time = document.getElementById('modalTime').textContent;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const purpose = document.getElementById('purpose').value;

            fetch(window.location.href, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    start_time: time,
                    end_time: time,
                    username: username,
                    password: password,
                    purpose: purpose
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    alert('Horário agendado com sucesso!');
                    closeBookingModal();
                    location.reload();
                }
            });
        }
    </script>
</body>
</html>
